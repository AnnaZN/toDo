let boxFilterCustom=document.getElementsByClassName("toDo__header-filter-custom");for(let e=0;e<boxFilterCustom.length;e++){let t=boxFilterCustom[e].getElementsByTagName("select")[0];const o=document.createElement("DIV");o.setAttribute("class","select-selected"),o.innerHTML=t.options[t.selectedIndex].innerHTML,boxFilterCustom[e].appendChild(o),itemsSelectHide=document.createElement("DIV"),itemsSelectHide.setAttribute("class","select-items select-hide");for(let e=0;e<t.length;e++){let o=document.createElement("DIV");o.innerHTML=t.options[e].innerHTML,o.addEventListener("click",(function(){let e=this.parentNode.parentNode.getElementsByTagName("select")[0],t=this.parentNode.previousSibling;for(let o=0;o<e.length;o++)if(e.options[o].innerHTML==this.innerHTML){let d=this.parentNode.getElementsByClassName("same-as-selected");e.selectedIndex=o,t.innerHTML=this.innerHTML;for(let e=0;e<d.length;e++)d[e].removeAttribute("class");this.setAttribute("class","same-as-selected");break}t.click()})),itemsSelectHide.appendChild(o)}boxFilterCustom[e].appendChild(itemsSelectHide),o.addEventListener("click",(function(e){e.stopPropagation(),closeAllSelect(this),this.nextSibling.classList.toggle("select-hide"),this.classList.toggle("select-arrow-active")}))}function closeAllSelect(e){let t=[],o=document.getElementsByClassName("select-items"),d=document.getElementsByClassName("select-selected");for(let o=0;o<d.length;o++)e==d[o]&&t.push(o);for(let e=0;e<o.length;e++)t.indexOf(e)&&o[e].classList.add("select-hide")}document.addEventListener("click",closeAllSelect);const modalWindow=document.querySelector(".reference-modal-window"),showModalWindowBtn=document.querySelector(".toDo__header-reference-cmd"),closeModalWindow=document.querySelector(".reference-modal-window-close-btn");function toggleModalWindow(){modalWindow.classList.toggle("reference-modal-window-show")}function showHideDescription(e){let t=e.target.closest(".description-link-box").nextElementSibling;0==t.classList.contains("show-hide-description")?t.classList.add("show-hide-description"):t.classList.remove("show-hide-description")}function getDataToDo(){let e;e=null===localStorage.getItem("dataToDo")?[]:JSON.parse(localStorage.getItem("dataToDo")),e.forEach((function(e){const t=document.createElement("li");t.classList.add("toDo__added-item"),t.setAttribute("data-todo-state",e.state),createButtonAddedItemOkCmd(t),createTaskStorageField(t,e.task),createButtontoDoAddedItemEditCmd(t),createbuttontoDoAddedItemDeleteCmd(t),listAddedItems.insertBefore(t,listAddedItems.childNodes[0])}))}function filter(){const e=document.querySelector(".toDo__header-filter").value;document.querySelector(".toDo__added-box").dataset.todoOption=e}showModalWindowBtn.addEventListener("click",toggleModalWindow),closeModalWindow.addEventListener("click",toggleModalWindow),document.querySelectorAll(".description-link").forEach((function(e){e.addEventListener("click",showHideDescription)})),document.addEventListener("DOMContentLoaded",getDataToDo),document.querySelector(".select-selected").addEventListener("click",filter),document.querySelector(".toDo__header-select-all-cmd").addEventListener("click",(()=>{document.querySelectorAll('.toDo__added-item[data-todo-state="active"]').forEach((e=>{e.dataset.todoState="completed",e.querySelector(".toDo__added-element").querySelector(".toDo__added-element-text").classList.remove("bg-none")})),null===localStorage.getItem("dataToDo")?dataToDo=[]:dataToDo=JSON.parse(localStorage.getItem("dataToDo")),dataToDo.forEach((e=>{"active"===e.state&&(e.state="completed")})),localStorage.setItem("dataToDo",JSON.stringify(dataToDo))})),document.querySelector(".toDo__header-remove-all-cmd").addEventListener("click",(()=>{document.querySelectorAll('.toDo__added-item[data-todo-state="completed"]').forEach((e=>{e.dataset.todoState="active",e.querySelector(".toDo__added-element").querySelector(".toDo__added-element-text").classList.add("bg-none")})),null===localStorage.getItem("dataToDo")?dataToDo=[]:dataToDo=JSON.parse(localStorage.getItem("dataToDo")),dataToDo.forEach((e=>{"completed"===e.state&&(e.state="active")})),localStorage.setItem("dataToDo",JSON.stringify(dataToDo))})),document.querySelector(".toDo__header-save-cmd").addEventListener("click",(()=>{const e=document.createElement("a");e.download="tasks.txt";let t="1. Активные задачи";document.querySelectorAll('.toDo__added-item[data-todo-state="active"]').forEach(((e,o)=>{t+="\n1."+(o+1)+". "+e.querySelector(".toDo__added-element").firstElementChild.textContent})),t+="\n\n2. Завершённые задачи",itemsCompleted=document.querySelectorAll('.toDo__added-item[data-todo-state="completed"]'),itemsCompleted.forEach(((e,o)=>{t+="\n2."+(o+1)+". "+e.querySelector(".toDo__added-element").firstElementChild.textContent})),e.href=window.URL.createObjectURL(new Blob([t],{type:"text/plain"})),e.click()}));const inputTodo=document.querySelector(".toDo__add-item-element"),listAddedItems=document.getElementById("toDo-list-added-items");function windowOnClick(e){e.target!==inputTodo&&addItemArray(inputTodo)}function addItemArray(){!inputTodo.disabled&&inputTodo.value.length&&(renderItemArray(inputTodo),saveNewDataToDo(inputTodo.value),inputTodo.value="")}function renderItemArray(e){const t=document.createElement("li");t.classList.add("toDo__added-item"),t.setAttribute("data-todo-state","active"),createButtonAddedItemOkCmd(t),createTaskStorageField(t,e.value),createButtontoDoAddedItemEditCmd(t),createbuttontoDoAddedItemDeleteCmd(t),listAddedItems.insertBefore(t,listAddedItems.childNodes[0])}function saveNewDataToDo(e){let t,o={task:"",state:""};t=null===localStorage.getItem("dataToDo")?[]:JSON.parse(localStorage.getItem("dataToDo")),o.task=String(e),o.state="active",t.push(o),localStorage.setItem("dataToDo",JSON.stringify(t))}function createButtonAddedItemOkCmd(e){const t=document.createElement("div");t.classList.add("toDo__added-item-ok"),e.appendChild(t);const o=document.createElement("button");o.classList.add("toDo__added-item-ok-cmd"),o.classList.add("todo__action"),o.setAttribute("type","submit"),o.setAttribute("data-todo-action","completed"),o.setAttribute("id","toDo-added-item-ok"),o.setAttribute("aria-label","ok"),o.addEventListener("click",(function(e){completeItem(e.target)})),t.appendChild(o);const d=document.createElement("div");d.classList.add("toDo__added-item-ok-box"),o.appendChild(d);const a=document.createElement("img");a.classList.add("toDo__added-item-ok-img"),a.setAttribute("src","images/maked_task.png"),a.setAttribute("alt","complete"),d.appendChild(a)}function completeItem(e){const t=e.closest(".toDo__added-item"),o=t.querySelector(".toDo__added-element").querySelector(".toDo__added-element-text"),d=t.innerText;null===localStorage.getItem("dataToDo")?dataToDo=[]:dataToDo=JSON.parse(localStorage.getItem("dataToDo")),itemCompleteArray=dataToDo.find((e=>e.task===d&&e.state===t.dataset.todoState)),"completed"==t.dataset.todoState?(t.dataset.todoState="active",o.classList.add("bg-none"),itemCompleteArray.state="active"):(t.dataset.todoState="completed",o.classList.remove("bg-none"),itemCompleteArray.state="completed"),localStorage.setItem("dataToDo",JSON.stringify(dataToDo))}function createTaskStorageField(e,t){const o=document.createElement("div");o.classList.add("toDo__added-element"),e.appendChild(o);const d=document.createElement("div");d.classList.add("toDo__added-element-text"),d.classList.add("highlighted"),d.classList.add("highlighted-width"),"active"===e.dataset.todoState&&d.classList.add("bg-none"),d.setAttribute("contenteditable","false"),d.textContent=t,o.appendChild(d)}function createButtontoDoAddedItemEditCmd(e){const t=document.createElement("div");t.classList.add("toDo__added-item-edit"),e.appendChild(t);const o=document.createElement("button");o.classList.add("toDo__added-item-edit-cmd"),o.classList.add("todo__action"),o.setAttribute("type","submit"),o.setAttribute("id","toDo-added-item-edit"),o.setAttribute("aria-label","edit"),o.addEventListener("click",(function(e){editItem(e.target)})),t.appendChild(o);const d=document.createElement("div");d.classList.add("toDo__added-item-edit-box"),o.appendChild(d);const a=document.createElement("img");a.classList.add("toDo__added-item-edit-img"),a.setAttribute("src","images/edit_task.svg"),a.setAttribute("alt","edit"),d.appendChild(a)}function editItem(e){const t=e.closest(".toDo__added-item");let o=e.closest(".toDo__added-item").querySelector(".toDo__added-element").querySelector(".toDo__added-element-text"),d=o.innerText;o.addEventListener("keydown",(e=>{13!=e.keyCode||e.shiftKey||(o.contentEditable="false",o.parentNode.classList.remove("editable"),saveEditItemArray(t,o.innerText,d))})),o.addEventListener("focusout",(function(){o.contentEditable="false",o.parentNode.classList.remove("editable"),saveEditItemArray(t,o.innerText,d)})),o.contentEditable="true",o.parentNode.classList.add("editable"),o.innerText=d,o.focus(),placeCaretAtEnd(o)}function placeCaretAtEnd(e){if(e.focus(),void 0!==window.getSelection&&void 0!==document.createRange){var t=document.createRange();t.selectNodeContents(e),t.collapse(!1);var o=window.getSelection();o.removeAllRanges(),o.addRange(t)}else if(void 0!==document.body.createTextRange){var d=document.body.createTextRange();d.moveToElementText(e),d.collapse(!1),d.select()}}function saveEditItemArray(e,t,o){null===localStorage.getItem("dataToDo")?dataToDo=[]:dataToDo=JSON.parse(localStorage.getItem("dataToDo")),itemEditArray=dataToDo.find((t=>t.task===o&&t.state===e.dataset.todoState)),itemEditArray.task=t,localStorage.setItem("dataToDo",JSON.stringify(dataToDo))}function createbuttontoDoAddedItemDeleteCmd(e){const t=document.createElement("div");t.classList.add("toDo__added-item-delete"),e.appendChild(t);const o=document.createElement("button");o.classList.add("toDo__added-item-delete-cmd"),o.classList.add("todo__action"),o.setAttribute("type","submit"),o.setAttribute("id","toDo-added-item-delete"),o.setAttribute("aria-label","delete"),o.addEventListener("click",(function(e){deleteItem(e.target)})),t.appendChild(o);const d=document.createElement("div");d.classList.add("toDo__added-item-delete-box"),o.appendChild(d);const a=document.createElement("img");a.classList.add("toDo__added-item-delete-img"),a.setAttribute("src","images/delete_task.png"),a.setAttribute("alt","delete"),d.appendChild(a)}function deleteItem(e){const t=e.closest(".toDo__added-item"),o=t.parentNode,d=t.innerText;let a;a=null===localStorage.getItem("dataToDo")?[]:JSON.parse(localStorage.getItem("dataToDo")),itemDeleteArray=a.find((e=>e.task===d&&e.state===t.dataset.todoState)),a.splice(a.indexOf(itemDeleteArray),1),localStorage.setItem("dataToDo",JSON.stringify(a)),o.removeChild(t)}document.getElementById("toDo-add-item-btn").addEventListener("click",addItemArray),inputTodo.addEventListener("keyup",(e=>{13!=e.which&&13!=e.keyCode||addItemArray(inputTodo)})),window.addEventListener("click",windowOnClick);