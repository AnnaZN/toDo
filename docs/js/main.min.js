let boxFilterCustom=document.getElementsByClassName("toDo__header-filter-custom");for(let e=0;e<boxFilterCustom.length;e++){let t=boxFilterCustom[e].getElementsByTagName("select")[0];const o=document.createElement("DIV");o.setAttribute("class","select-selected"),o.innerHTML=t.options[t.selectedIndex].innerHTML,boxFilterCustom[e].appendChild(o),itemsSelectHide=document.createElement("DIV"),itemsSelectHide.setAttribute("class","select-items select-hide");for(let e=0;e<t.length;e++){let o=document.createElement("DIV");o.innerHTML=t.options[e].innerHTML,o.addEventListener("click",(function(){let e=this.parentNode.parentNode.getElementsByTagName("select")[0],t=this.parentNode.previousSibling;for(let o=0;o<e.length;o++)if(e.options[o].innerHTML==this.innerHTML){let a=this.parentNode.getElementsByClassName("same-as-selected");e.selectedIndex=o,t.innerHTML=this.innerHTML;for(let e=0;e<a.length;e++)a[e].removeAttribute("class");this.setAttribute("class","same-as-selected");break}t.click()})),itemsSelectHide.appendChild(o)}boxFilterCustom[e].appendChild(itemsSelectHide),o.addEventListener("click",(function(e){e.stopPropagation(),closeAllSelect(this),this.nextSibling.classList.toggle("select-hide"),this.classList.toggle("select-arrow-active")}))}function closeAllSelect(e){let t=[],o=document.getElementsByClassName("select-items"),a=document.getElementsByClassName("select-selected");for(let o=0;o<a.length;o++)e==a[o]&&t.push(o);for(let e=0;e<o.length;e++)t.indexOf(e)&&o[e].classList.add("select-hide")}document.addEventListener("click",closeAllSelect);const modalWindow=document.querySelector(".reference-modal-window"),showModalWindowBtn=document.querySelector(".toDo__header-reference-cmd"),closeModalWindow=document.querySelector(".reference-modal-window-close-btn");function toggleModalWindow(){modalWindow.classList.toggle("reference-modal-window-show")}function showHideDescription(e){let t=e.target.closest(".description-link-box").nextElementSibling;0==t.classList.contains("show-hide-description")?t.classList.add("show-hide-description"):t.classList.remove("show-hide-description")}function getDataToDo(){let e;e=null===localStorage.getItem("dataToDo")?[]:JSON.parse(localStorage.getItem("dataToDo")),e.forEach((function(e){const t=document.createElement("li");t.classList.add("toDo__added-item"),t.setAttribute("data-todo-state",e.state),createTaskCompletedButton(t),createTaskFromStorage(t,e.textTask),createTaskEditButton(t),createTaskDeleteButton(t),listTasks.insertBefore(t,listTasks.childNodes[0])}))}function filter(){const e=document.querySelector(".toDo__header-filter").value;document.querySelector(".toDo__added-box").dataset.todoOption=e}showModalWindowBtn.addEventListener("click",toggleModalWindow),closeModalWindow.addEventListener("click",toggleModalWindow),document.querySelectorAll(".description-link").forEach((function(e){e.addEventListener("click",showHideDescription)})),document.addEventListener("DOMContentLoaded",getDataToDo),document.querySelector(".select-selected").addEventListener("click",filter),document.querySelector(".toDo__header-select-all-cmd").addEventListener("click",(()=>{document.querySelectorAll('.toDo__added-item[data-todo-state="active"]').forEach((e=>{e.dataset.todoState="completed",e.querySelector(".toDo__added-element").querySelector(".toDo__added-element-text").classList.remove("bg-none")})),null===localStorage.getItem("dataToDo")?dataToDo=[]:dataToDo=JSON.parse(localStorage.getItem("dataToDo")),dataToDo.forEach((e=>{"active"===e.state&&(e.state="completed")})),localStorage.setItem("dataToDo",JSON.stringify(dataToDo))})),document.querySelector(".toDo__header-remove-all-cmd").addEventListener("click",(()=>{document.querySelectorAll('.toDo__added-item[data-todo-state="completed"]').forEach((e=>{e.dataset.todoState="active",e.querySelector(".toDo__added-element").querySelector(".toDo__added-element-text").classList.add("bg-none")})),null===localStorage.getItem("dataToDo")?dataToDo=[]:dataToDo=JSON.parse(localStorage.getItem("dataToDo")),dataToDo.forEach((e=>{"completed"===e.state&&(e.state="active")})),localStorage.setItem("dataToDo",JSON.stringify(dataToDo))})),document.querySelector(".toDo__header-save-cmd").addEventListener("click",(()=>{const e=document.createElement("a");e.download="tasks.txt";let t="1. Активные задачи";document.querySelectorAll('.toDo__added-item[data-todo-state="active"]').forEach(((e,o)=>{t+="\n1."+(o+1)+". "+e.querySelector(".toDo__added-element").firstElementChild.textContent})),t+="\n\n2. Завершённые задачи",itemsCompleted=document.querySelectorAll('.toDo__added-item[data-todo-state="completed"]'),itemsCompleted.forEach(((e,o)=>{t+="\n2."+(o+1)+". "+e.querySelector(".toDo__added-element").firstElementChild.textContent})),e.href=window.URL.createObjectURL(new Blob([t],{type:"text/plain"})),e.click()}));const inputTodo=document.querySelector(".toDo__add-item-element"),listTasks=document.getElementById("toDo-list-added-items");function windowOnClick(e){e.target!==inputTodo&&addTask(inputTodo)}function addTask(){inputTodo.disabled||!inputTodo.value.length||/\s/.test(inputTodo.value)||(renderTaskArray(inputTodo),saveNewDataToDo(inputTodo.value)),inputTodo.value=""}function renderTaskArray(e){const t=document.createElement("li");t.classList.add("toDo__added-item"),t.setAttribute("data-todo-state","active"),createTaskCompletedButton(t),createTaskFromStorage(t,e.value),createTaskEditButton(t),createTaskDeleteButton(t),listTasks.insertBefore(t,listTasks.childNodes[0])}function saveNewDataToDo(e){let t,o={textTask:"",state:""};t=null===localStorage.getItem("dataToDo")?[]:JSON.parse(localStorage.getItem("dataToDo")),o.textTask=String(e),o.state="active",t.push(o),localStorage.setItem("dataToDo",JSON.stringify(t))}function createTaskCompletedButton(e){const t=document.createElement("div");t.classList.add("toDo__added-item-ok"),e.appendChild(t);const o=document.createElement("button");o.classList.add("toDo__added-item-ok-cmd"),o.classList.add("todo__action"),o.setAttribute("type","submit"),o.setAttribute("data-todo-action","completed"),o.setAttribute("id","toDo-added-item-ok"),o.setAttribute("aria-label","ok"),o.addEventListener("click",(function(e){completeTask(e.target)})),t.appendChild(o);const a=document.createElement("div");a.classList.add("toDo__added-item-ok-box"),o.appendChild(a);const d=document.createElement("img");d.classList.add("toDo__added-item-ok-img"),d.setAttribute("src","images/maked_task.png"),d.setAttribute("alt","complete"),a.appendChild(d)}function completeTask(e){const t=e.closest(".toDo__added-item"),o=t.querySelector(".toDo__added-element").querySelector(".toDo__added-element-text"),a=t.innerText;null===localStorage.getItem("dataToDo")?dataToDo=[]:dataToDo=JSON.parse(localStorage.getItem("dataToDo")),taskCompleteArray=dataToDo.find((e=>e.textTask===a&&e.state===t.dataset.todoState)),"completed"==t.dataset.todoState?(t.dataset.todoState="active",o.classList.add("bg-none"),taskCompleteArray.state="active"):(t.dataset.todoState="completed",o.classList.remove("bg-none"),taskCompleteArray.state="completed"),localStorage.setItem("dataToDo",JSON.stringify(dataToDo))}function createTaskFromStorage(e,t){const o=document.createElement("div");o.classList.add("toDo__added-element"),e.appendChild(o);const a=document.createElement("div");a.classList.add("toDo__added-element-text"),a.classList.add("highlighted"),a.classList.add("highlighted-width"),"active"===e.dataset.todoState&&a.classList.add("bg-none"),a.setAttribute("contenteditable","false"),a.textContent=t,o.appendChild(a)}function createTaskEditButton(e){const t=document.createElement("div");t.classList.add("toDo__added-item-edit"),e.appendChild(t);const o=document.createElement("button");o.classList.add("toDo__added-item-edit-cmd"),o.classList.add("todo__action"),o.setAttribute("type","submit"),o.setAttribute("id","toDo-added-item-edit"),o.setAttribute("aria-label","edit"),o.addEventListener("click",(function(e){editTask(e.target)})),t.appendChild(o);const a=document.createElement("div");a.classList.add("toDo__added-item-edit-box"),o.appendChild(a);const d=document.createElement("img");d.classList.add("toDo__added-item-edit-img"),d.setAttribute("src","images/edit_task.svg"),d.setAttribute("alt","edit"),a.appendChild(d)}function editTask(e){const t=e.closest(".toDo__added-item");let o=e.closest(".toDo__added-item").querySelector(".toDo__added-element").querySelector(".toDo__added-element-text"),a=o.innerText;o.addEventListener("keydown",(e=>{13!=e.keyCode||e.shiftKey||(o.contentEditable="false",o.parentNode.classList.remove("editable"),saveEditTaskArray(t,o.innerText,a))})),o.addEventListener("focusout",(function(){o.contentEditable="false",o.parentNode.classList.remove("editable"),saveEditTaskArray(t,o.innerText,a)})),o.contentEditable="true",o.parentNode.classList.add("editable"),o.innerText=a,o.focus(),placeCaretAtEnd(o)}function placeCaretAtEnd(e){if(e.focus(),void 0!==window.getSelection&&void 0!==document.createRange){var t=document.createRange();t.selectNodeContents(e),t.collapse(!1);var o=window.getSelection();o.removeAllRanges(),o.addRange(t)}else if(void 0!==document.body.createTextRange){var a=document.body.createTextRange();a.moveToElementText(e),a.collapse(!1),a.select()}}function saveEditTaskArray(e,t,o){null===localStorage.getItem("dataToDo")?dataToDo=[]:dataToDo=JSON.parse(localStorage.getItem("dataToDo")),taskEditArray=dataToDo.find((t=>t.textTask===o&&t.state===e.dataset.todoState)),taskEditArray.textTask=t,localStorage.setItem("dataToDo",JSON.stringify(dataToDo))}function createTaskDeleteButton(e){const t=document.createElement("div");t.classList.add("toDo__added-item-delete"),e.appendChild(t);const o=document.createElement("button");o.classList.add("toDo__added-item-delete-cmd"),o.classList.add("todo__action"),o.setAttribute("type","submit"),o.setAttribute("id","toDo-added-item-delete"),o.setAttribute("aria-label","delete"),o.addEventListener("click",(function(e){deleteTask(e.target)})),t.appendChild(o);const a=document.createElement("div");a.classList.add("toDo__added-item-delete-box"),o.appendChild(a);const d=document.createElement("img");d.classList.add("toDo__added-item-delete-img"),d.setAttribute("src","images/delete_task.png"),d.setAttribute("alt","delete"),a.appendChild(d)}function deleteTask(e){const t=e.closest(".toDo__added-item"),o=t.parentNode,a=t.innerText;let d;d=null===localStorage.getItem("dataToDo")?[]:JSON.parse(localStorage.getItem("dataToDo")),taskDeleteArray=d.find((e=>e.textTask===a&&e.state===t.dataset.todoState)),d.splice(d.indexOf(taskDeleteArray),1),localStorage.setItem("dataToDo",JSON.stringify(d)),o.removeChild(t)}document.getElementById("toDo-add-item-btn").addEventListener("click",addTask),inputTodo.addEventListener("keyup",(e=>{13!=e.which&&13!=e.keyCode||addTask(inputTodo)})),window.addEventListener("click",windowOnClick);